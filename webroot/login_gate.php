<?php

$loggedin = false;
$isAdmin = false;
$jwt = "";
// check if token exist and then if not empty
if(isset($_COOKIE['TOKEN'])) {
    if(!empty($_COOKIE['TOKEN'])) {
        if (is_jwt_valid($_COOKIE['TOKEN'])) {
            $jwt = $_COOKIE['TOKEN'];
            $loggedin = true;
        }
    }
}

if (!isset($firstpage) && !$loggedin) {
    echo("<body>");
    echo("<h2>Ã–h, logga in</h2>");
    echo("<a href='/login.php'>LOGIN</a>");
    echo("</body>");
    exit();
}

// Check if admin

$c = "mysql:host=". DB_HOST . ";dbname=". DB_NAME .";charset=" . DB_CHARSET . ";";
$con = new PDO($c, DB_USER, DB_PASSWORD);
if ($con) {
    $userid = getTag($jwt, "sub");
    $stmt = $con->prepare("SELECT * FROM `" . TABLE_NAME_USERS . "` WHERE `id` = :id AND `admin` = 1");
    print_r("SELECT * FROM `" . TABLE_NAME_USERS . "` WHERE `id` = :id AND `admin` = 1");
    $stmt->bindParam(":id", $userid, PDO::PARAM_INT);
    $stmt->execute();
    if ($stmt->rowCount() > 0) {
        if ($stmt->fetch(PDO::FETCH_ASSOC)['admin'] == 1) {
            $isAdmin = true;
        }
    }
}
$con=null;
$c=null;

?>

<!DOCTYPE html>