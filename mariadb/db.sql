CREATE DATABASE service;

USE service;

CREATE TABLE `service_motd` (
  `id` int(11) NOT NULL,
  `text` text NOT NULL,
  `da` datetime NOT NULL DEFAULT current_timestamp()
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_swedish_ci;

ALTER TABLE `service_motd`
  ADD PRIMARY KEY (`id`);

INSERT INTO `service_motd` (`id`, `text`, `da`) VALUES
(1, 'Hello', '2023-06-11 13:37:00');

CREATE TABLE `service_posts` (
  `id` int(11) NOT NULL,
  `posted_by` int(11) NOT NULL,
  `text` varchar(280) NOT NULL,
  `datetime` datetime NOT NULL DEFAULT current_timestamp(),
  `likes` int(11) NOT NULL DEFAULT 0
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_swedish_ci;

ALTER TABLE `service_posts`
  ADD PRIMARY KEY (`id`);

CREATE TABLE `service_users` (
  `id` int(16) NOT NULL,
  `name` varchar(32) NOT NULL,
  `username` varchar(32) NOT NULL,
  `password` varchar(512) DEFAULT NULL,
  `datetime` datetime NOT NULL DEFAULT current_timestamp(),
  `admin` tinyint(1) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_swedish_ci;

INSERT INTO `service_users` (`id`, `name`, `username`, `password`, `datetime`, `admin`) VALUES
(1, 'admin', 'admin', '$2y$10$bbpNySr7LcSGdQiMntcUveMgVSOVEBrJRGghxllFZTTbyKahQ9FTS', '2023-06-11 13:37:00', 1);


ALTER TABLE `service_users`
  ADD PRIMARY KEY (`id`),
  ADD UNIQUE KEY `username` (`username`);

GRANT ALL PRIVILEGES ON *.* TO `serviceuser`@`%` IDENTIFIED BY PASSWORD '*C9095F937B699451E17975C54BD9143A6D1DA812' WITH GRANT OPTION;

ALTER TABLE `service_motd`
  MODIFY `id` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=10;

ALTER TABLE `service_posts`
  MODIFY `id` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=10;

ALTER TABLE `service_users`
  MODIFY `id` int(16) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=10;
COMMIT;