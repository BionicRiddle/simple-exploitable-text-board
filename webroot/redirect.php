<?php

header("Cache-Control: no-store, no-cache, must-revalidate, max-age=0");
header("Cache-Control: post-check=0, pre-check=0", false);
header("Pragma: no-cache");

require 'config.php';
require 'helpers.php';
if ($_SERVER['REQUEST_METHOD'] === 'GET') {
    if(isset($_GET['token'])) {
        if(!empty($_GET['token'])) {
            $jwt = "";
            if (is_jwt_valid($_GET['token'])) {
                $jwt = $_GET['token'];
            } else {
                exit();
            }

            $exp = getTag($jwt, "exp");

            $domain = explode("/", (explode('https://', HOST)[1]))[0];
            
            $arr_cookie_options = array (
                'expires' => $exp,
                'path' => '/',
                'domain' => $domain,
                'secure' => true,
                'httponly' => false,
                'samesite' => 'Strict' // None || Lax  || Strict
            );

            setcookie("TOKEN", $jwt, $arr_cookie_options);
            header("Location: " . HOST);
            echo('<a href="' . HOST . '" >REDIRECT</a>');
            exit();
        }
    }
}


?>